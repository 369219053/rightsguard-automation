# 权利卫士应用分析报告

## 📱 应用基本信息

| 项目 | 详情 |
|------|------|
| **包名** | `com.unitrust.tsa` |
| **版本号** | 4.7.0.0 (versionCode: 4700) |
| **目标SDK** | Android 13 (API 33) |
| **最低SDK** | Android 8.0 (API 26) |
| **CPU架构** | arm64-v8a |
| **安装时间** | 2026-01-11 11:10:12 |
| **进程ID** | 10950 |
| **用户ID** | u0_a320 |

---

## 🎯 核心Activity和Service

### 主要Activity
1. **启动页**: `cn.tsa.activity.SplashActivity`
2. **录屏界面**: `cn.tsa.rights.viewer.screen.ScreenRecorderActivity` (当前正在显示)
3. **消息界面**: `cn.tsa.activity.MfrMessageActivity`

### 核心Service
1. **通话监听服务**: `cn.tsa.service.CallListenerService`
2. **前台服务**: 支持 `FOREGROUND_SERVICE` 和 `FOREGROUND_SERVICE_MICROPHONE`

---

## 🔐 权限分析

### 已授予的关键权限
- ✅ `CAMERA` - 摄像头权限
- ✅ `POST_NOTIFICATIONS` - 通知权限
- ✅ `READ_MEDIA_VIDEO` - 读取视频权限
- ✅ `READ_MEDIA_VISUAL_USER_SELECTED` - 读取用户选择的媒体
- ✅ `FOREGROUND_SERVICE` - 前台服务
- ✅ `FOREGROUND_SERVICE_MICROPHONE` - 前台麦克风服务
- ✅ `INTERNET` - 网络访问
- ✅ `ACCESS_NETWORK_STATE` - 网络状态
- ✅ `ACCESS_WIFI_STATE` - WiFi状态
- ✅ `RECEIVE_BOOT_COMPLETED` - 开机自启
- ✅ `WAKE_LOCK` - 保持唤醒
- ✅ `QUERY_ALL_PACKAGES` - 查询所有应用

### 未授予的权限
- ❌ `ACCESS_FINE_LOCATION` - 精确定位
- ❌ `ACCESS_COARSE_LOCATION` - 粗略定位
- ❌ `READ_PHONE_STATE` - 读取手机状态
- ❌ `CALL_PHONE` - 拨打电话
- ❌ `READ_MEDIA_IMAGES` - 读取图片
- ❌ `READ_MEDIA_AUDIO` - 读取音频

---

## 🖥️ 当前UI界面分析

### 录屏取证界面元素

#### 主要控件
1. **标题栏**: "录屏取证"
2. **返回按钮**: `com.unitrust.tsa:id/rl_back`
3. **自定义名称输入框**: `com.unitrust.tsa:id/ed_remark`
   - 提示文字: "输入自定义名称(选填,不会显示在证书上)"
4. **开始录屏按钮**: `com.unitrust.tsa:id/rl_btn`
   - 按钮文字: "开始录屏取证"
   - 图标: `com.unitrust.tsa:id/image_start`
5. **操作指引**: `com.unitrust.tsa:id/tv_caozuo`
6. **麦克风开关**: `com.unitrust.tsa:id/image_switch`
7. **位置信息开关**: `com.unitrust.tsa:id/switch_screen`
   - 文字: "在证书上显示位置信息"
   - 当前状态: 已开启 (checked="true")

#### 注意事项
1. **计费规则**: 首10分钟扣3个时间戳,之后每10分钟扣2个时间戳
2. **中断情况**:
   - 录屏过程中锁屏
   - 录屏过程中拨打或接听电话
3. **内存要求**: 1分钟约需20MB,建议不超过60分钟
4. **系统稳定性**: 建议清除后台应用
5. **环境清洁性**: 不要修改取证环境设置

---

## 🌐 网络检测分析

### 网络相关权限
- ✅ `INTERNET` - 已授予
- ✅ `ACCESS_NETWORK_STATE` - 已授予
- ✅ `ACCESS_WIFI_STATE` - 已授予
- ✅ `CHANGE_NETWORK_STATE` - 已授予
- ✅ `CHANGE_WIFI_STATE` - 已授予

### 可能的网络检测机制
根据权限和应用特性,权利卫士可能会进行以下网络检测:
1. **网络连接状态检测** - 检查是否联网
2. **网络类型检测** - WiFi/移动数据
3. **时间戳服务器连接** - 用于取证时间戳认证
4. **证书上传服务** - 录屏完成后上传到服务器

---

## 🤖 自动化APK兼容性分析

### ✅ 好消息 - 不会冲突!

#### 技术层面
1. **服务类型不同**
   - 权利卫士: 使用 `MediaProjection API` (录屏服务)
   - 自动化APK: 使用 `Accessibility Service` (无障碍服务)
   - **结论**: 两个服务互不干扰,可以同时运行

2. **前台服务共存**
   - Android允许多个前台服务同时运行
   - 权利卫士已经在使用前台服务
   - 自动化APK也可以启动自己的前台服务
   - **结论**: 可以共存

3. **权限体系独立**
   - 录屏权限、无障碍权限、悬浮窗权限都是独立的
   - **结论**: 不会互相冲突

#### 实际运行状态
- 当前权利卫士进程正在运行 (PID: 10950)
- 内存占用: 约330MB
- 没有发现明显的后台限制机制

---

## ⚠️ 潜在问题和注意事项

### 1. vivo系统限制
- **后台管理严格**: vivo的Funtouch OS对后台应用管理很严格
- **需要配置**: 自启动、后台高耗电、电池优化等

### 2. 录屏中断风险
根据应用提示,以下情况会导致录屏中断:
- 锁屏
- 来电或拨打电话
- **自动化操作可能触发这些情况**

### 3. 网络依赖
- 应用需要网络连接进行时间戳认证
- 自动化时需要确保网络稳定

### 4. 资源占用
- 录屏本身占用较多资源(1分钟约20MB)
- 自动化APK也会占用资源
- 建议清除其他后台应用

---

## 🎯 自动化方案建议

### 推荐方案: Accessibility Service

#### 核心操作流程
1. **启动权利卫士**
   ```
   Intent: android.intent.action.MAIN
   Component: com.unitrust.tsa/cn.tsa.activity.SplashActivity
   ```

2. **等待录屏界面加载**
   ```
   等待Activity: cn.tsa.rights.viewer.screen.ScreenRecorderActivity
   ```

3. **点击开始录屏按钮**
   ```
   Resource ID: com.unitrust.tsa:id/rl_btn
   Text: "开始录屏取证"
   ```

4. **处理系统录屏权限弹窗**
   ```
   需要点击"立即开始"或类似按钮
   ```

5. **监控录屏状态**
   ```
   通过UI元素变化判断录屏是否开始
   ```

6. **停止录屏**
   ```
   通过通知栏或返回应用点击停止按钮
   ```

#### 关键技术点
- 使用 `AccessibilityService` 查找和点击UI元素
- 使用 `waitForIdle()` 等待界面稳定
- 使用 `UiSelector` 精确定位控件
- 处理系统权限弹窗

---

## 📝 总结

### ✅ 可行性
- **技术上完全可行**: 自动化APK和权利卫士可以同时运行
- **无本质冲突**: 使用不同的系统服务,互不干扰

### ⚠️ 需要注意
- **vivo系统配置**: 需要仔细配置后台权限
- **避免中断**: 自动化过程中避免锁屏和来电
- **网络稳定**: 确保网络连接正常
- **资源管理**: 清除其他后台应用

### 🚀 下一步
1. 开发Accessibility Service自动化APK
2. 在vivo真机上测试
3. 优化稳定性和容错机制

