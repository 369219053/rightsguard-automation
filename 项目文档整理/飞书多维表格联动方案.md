# 飞书多维表格联动方案

[← 返回README](../README.md)

---

## 📋 方案概述

本文档详细说明如何打通**飞书多维表格 → Android APK**的完整取证链路,实现从侵权线索到自动化取证的一键触发。

---

## 🎯 完整业务流程

```
自动化采集项目
    ↓ 采集侵权线索
飞书多维表格
    ↓ 客户点击"开始取证"
飞书自动化
    ↓ 发送消息到飞书群
飞书群聊
    ↓ 客户点击"启动取证"按钮
Android APK
    ↓ 自动化取证(录屏+截图)
飞书API
    ↓ 回传结果到多维表格
完成
```

---

## 📊 多维表格字段设计

### 现有字段
- 侵权视频链接 (URL)
- 侵权博主名称 (文本)
- 产品名称 (文本)

### 新增字段

| 字段名称 | 字段类型 | 说明 | 配置 |
|---------|---------|------|------|
| 任务ID | 文本 | 唯一标识 | 公式: `"TASK_" & TEXT(CREATED_TIME(), "YYYYMMDD_HHmmss")` |
| 取证状态 | 单选 | 任务状态 | 选项: 🟡待取证、🔵取证中、🟢已完成、🔴失败 |
| 开始取证 | 按钮 | 触发按钮 | 按钮文本: "🎯 开始取证" |
| 取证时间 | 日期时间 | 开始时间 | - |
| 完成时间 | 日期时间 | 完成时间 | - |
| 证据截图 | 附件 | 截图文件 | - |
| 录屏视频 | 附件 | 录屏文件 | - |
| 取证备注 | 多行文本 | 备注信息 | - |
| 操作人 | 人员 | 操作人员 | - |

---

## 🚀 实施步骤

### 步骤1: 配置飞书多维表格 (10分钟)

#### 1.1 添加字段

在多维表格中按照上表添加所有新字段。

#### 1.2 创建飞书群聊

创建一个专门的"取证任务群",用于接收取证通知。

---

### 步骤2: 创建飞书自定义机器人 (5分钟)

#### 2.1 添加机器人

1. 打开"取证任务群"
2. 点击右上角"..." → "设置" → "群机器人"
3. 点击"添加机器人" → "自定义机器人"
4. 设置机器人名称: "取证任务助手"
5. 复制Webhook地址,格式如下:
   ```
   https://open.feishu.cn/open-apis/bot/v2/hook/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
   ```

#### 2.2 保存Webhook地址

将Webhook地址保存好,后续配置自动化时需要使用。

---

### 步骤3: 配置飞书自动化 (30分钟)

#### 3.1 创建自动化流程

1. 在飞书多维表格中,点击右上角"自动化"按钮
2. 点击"创建自动化"
3. 设置触发条件: **当"开始取证"按钮被点击时**
4. 添加执行动作: **运行脚本**

#### 3.2 自动化脚本

将以下脚本复制到飞书自动化的脚本编辑器中:

```javascript
// 飞书自动化脚本 - 发送取证任务到群聊

// 1. 获取当前记录数据
const record = input.record;

// 2. 生成任务ID（如果没有）
const taskId = record.fields['任务ID'] || `TASK_${Date.now()}`;

// 3. 构造Deep Link URL
const deepLinkUrl = `rightsguard://evidence?` + 
    `taskId=${encodeURIComponent(taskId)}` +
    `&url=${encodeURIComponent(record.fields['侵权视频链接'])}` +
    `&author=${encodeURIComponent(record.fields['侵权博主名称'])}` +
    `&product=${encodeURIComponent(record.fields['产品名称'])}` +
    `&recordId=${encodeURIComponent(record.recordId)}`;

// 4. 构造飞书消息卡片
const message = {
    "msg_type": "interactive",
    "card": {
        "header": {
            "title": {
                "content": "🎯 新的取证任务",
                "tag": "plain_text"
            },
            "template": "blue"
        },
        "elements": [
            {
                "tag": "div",
                "fields": [
                    {
                        "is_short": true,
                        "text": {
                            "tag": "lark_md",
                            "content": `**任务ID**\n${taskId}`
                        }
                    },
                    {
                        "is_short": true,
                        "text": {
                            "tag": "lark_md",
                            "content": `**产品**\n${record.fields['产品名称']}`
                        }
                    }
                ]
            },

