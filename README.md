# 权利卫士取证自动化系统

## 📖 项目简介

权利卫士取证自动化系统是一个基于Android Accessibility Service的自动化控制工具,用于自动化操作权利卫士应用进行录屏取证。系统通过无障碍服务实现对权利卫士应用的自动化控制,提高取证效率,减少人工操作成本。

### 核心价值
- ✅ **自动化取证** - 无需人工操作,自动完成录屏取证流程
- ✅ **提高效率** - 批量处理取证任务,节省时间成本
- ✅ **稳定可靠** - 基于Android系统服务,运行稳定
- ✅ **易于部署** - 支持vivo等主流Android设备

### 使用场景
- 批量录屏取证任务
- 无人值守自动化取证
- 定时取证任务执行
- 远程控制取证操作

---

## ✨ 核心功能

### 1. 自动化录屏控制
- ✅ 🆕 自动打开侵权链接 (V2.3 - WebView方案 + 智能返回)
  - 通过WebView(APP内嵌浏览器)访问侵权链接
  - 自动拦截URL Scheme直接打开抖音APP
  - 观看侵权视频5秒
  - 智能返回到抖音首页(最多返回2次)
  - 自动点击"我"按钮进入个人页面
  - 避免权利卫士环境检测
- ✅ 🆕 权利卫士取证阶段自动化 (V2.4新增) ⭐️
  - 点击"开始取证"后自动进入取证阶段
  - 监听抖音窗口事件,自动化操作
  - 随机延迟1-2秒,模拟真人操作
  - 自动点击"更多"按钮(三条杠)
  - 自动点击"设置"按钮
  - 智能点击(文本查找+坐标备用)
- ✅ 自动启动权利卫士应用
- ✅ 自动点击"录屏取证"按钮
- ✅ 自动填充备注内容(格式: 原创名称-抖音:侵权人名称)
- ✅ 自动点击"开始录屏取证"按钮
- ✅ 自动处理系统录屏权限弹窗
  - 智能检测"单个应用"下拉框
  - 自动点击"整个屏幕"选项
  - 自动点击"立即开始"按钮
- ✅ 自动处理应用验真界面
  - 自动选择抖音应用
  - 自动截屏保存验真页面
  - 自动点击"立即验证"按钮
- ✅ 自动清空剪贴板 (V2.0新增)
  - 在开始录屏前清空剪贴板
  - 避免打开抖音时弹出"打开看看"
  - 确保录屏过程符合取证要求
- ✅ 完整自动化流程(从打开侵权链接到权利卫士取证)

### 2. 截屏与报告生成
- ✅ 自动截屏保存应用验真页面
- ✅ 截图保存到公共相册(Pictures/权利卫士取证)
- 📋 生成PDF取证报告(开发中)
  - 自动收集所有截图
  - 按时间顺序整理
  - 生成完整PDF报告

### 3. 调试辅助工具
- 🔧 UI结构Dump功能(开发中,正式版将移除)
  - 悬浮窗快速Dump当前页面
  - 支持dump任何应用的UI结构
  - 复制、保存、分享功能
  - 方便开发调试和问题排查

### 4. 智能UI定位
- 文字查找定位(主要方式)
- 智能父节点查找
- 多层级节点遍历
- 状态检测与判断

### 5. 玻璃质感UI设计
- Material Design设计规范
- 淡蓝色玻璃质感卡片
- 立体悬浮效果
- 简洁现代的界面风格

### 6. 设备适配
- vivo设备深度适配
- 后台保活机制
- 电池优化配置
- 权限自动申请

### 7. 多维表格集成
- ✅ 智能解析取证信息
- ✅ 自动提取原创名称和侵权人信息
- ✅ 自动提取原创链接和侵权链接
- ✅ 一键复制粘贴,快速启动取证

---

## 🛠️ 技术栈

### Android开发
- **开发语言**: Java/Kotlin
- **最低SDK**: Android 8.0 (API 26)
- **目标SDK**: Android 13 (API 33)
- **核心技术**: Accessibility Service

### 自动化技术
- **UI自动化**: AccessibilityService
- **控件定位**: UiSelector、Resource ID
- **事件模拟**: 点击、滑动、输入
- **状态监控**: UI元素变化监听

### 数据集成
- **格式解析**: 智能解析取证信息字符串
- **多维表格**: 支持多维表格数据导入
- **数据提取**: 自动提取原创和侵权信息

### 目标应用
- **应用名称**: 权利卫士
- **包名**: com.unitrust.tsa
- **版本**: 4.7.0.0+
- **核心功能**: 录屏取证、时间戳认证

---

## 🚀 快速开始

### 环境要求
- Android设备 (Android 8.0+)
- 已安装权利卫士应用 (v4.7.0.0+)
- 开启无障碍服务权限
- 开启悬浮窗权限

### 安装步骤
1. 下载自动化APK安装包
2. 安装到目标Android设备
3. 开启无障碍服务权限
4. 开启悬浮窗权限
5. 配置后台保活(vivo设备)

### 启动使用

#### 使用流程
1. 在多维表格中生成取证信息
   - 格式: `原创名称-抖音:侵权人账号名称-原创分享链接+侵权人分享链接`
   - 示例: `张三-抖音:李四-https://www.douyin.com/xxx+https://www.douyin.com/yyy`
2. 复制取证信息
3. 打开自动化APK
4. 粘贴到"取证信息"输入框
5. 点击"开始"按钮
6. 系统自动解析信息并完成取证流程

详细使用说明请查看 [开发指南](./项目文档整理/开发指南.md)

---

## 📚 详细文档

### 核心文档
- [📘 开发指南](./项目文档整理/开发指南.md) - 环境配置、技术架构、开发流程、多维表格集成
- [🤖 自动化文档](./项目文档整理/自动化文档.md) - 自动化实现原理、核心代码、技术细节
- [❓ 常见问题FAQ](./项目文档整理/常见问题FAQ.md) - 常见问题、问题排查、解决方案
- [📝 Git版本记录](./项目文档整理/Git版本记录.md) - 版本更新日志、功能迭代记录
- [🎨 UI界面设计文档](./项目文档整理/UI界面设计文档.md) - 界面设计、配色方案、交互规范

### 功能设计文档
- [📸 智能截图功能设计](./项目文档整理/智能截图功能设计.md) - 视频取证智能截图系统设计方案
- [📊 多维表格集成](./项目文档整理/开发指南.md#多维表格集成) - 取证信息格式、解析逻辑

### 分析文档
- [📱 权利卫士应用分析报告](./权利卫士应用分析报告.md) - 目标应用的详细分析

---

## 🔗 重要链接

### 相关应用
- 权利卫士官网: [https://www.unitrust.cn](https://www.unitrust.cn)
- 权利卫士应用包名: `com.unitrust.tsa`

### 技术参考
- Android Accessibility Service: [官方文档](https://developer.android.com/guide/topics/ui/accessibility/service)
- Android UI Automator: [官方文档](https://developer.android.com/training/testing/ui-automator)

---

## ⚠️ 重要提示

### 环境要求 🔴 重要!

**权利卫士环境检测**:
- ⚠️ 权利卫士会检测开发者选项和USB调试
- ⚠️ 检测到异常环境会拒绝运行
- ✅ 使用时必须关闭开发者选项
- ✅ 使用时必须关闭USB调试
- ✅ 确保环境100%干净,保证取证有效性

**开发策略**:
- 开发阶段: 可以开启调试,用于开发和测试
- 使用阶段: 必须关闭调试,确保环境干净
- 采用文字查找定位,不依赖dump页面
- 详见 [开发指南](./项目文档整理/开发指南.md)

### 使用限制
- 本系统仅用于合法的取证自动化场景
- 需要在权利卫士应用已登录的状态下使用
- 录屏过程中请勿锁屏或接听电话
- 确保设备网络连接稳定
- **使用前必须关闭开发者选项**

### vivo设备配置
- 必须开启自启动权限
- 必须关闭电池优化
- 必须允许后台高耗电
- 必须开启悬浮窗权限

详细配置说明请查看 [常见问题](./项目文档整理/常见问题.md)

---

## 📅 更新日志

### V2.4 (2026-02-06) - 最新版本 🎯 权利卫士取证阶段自动化!

**权利卫士取证阶段自动化 - 随机延迟模拟真人操作**

- ✅ 点击"开始取证"后自动进入权利卫士取证阶段
- ✅ 监听抖音窗口事件,自动化操作抖音
- ✅ 添加随机延迟功能(1-2秒),模拟真人操作
- ✅ 自动点击抖音"更多"按钮(三条杠)
- ✅ 自动点击"设置"按钮
- ✅ 智能点击(优先文本查找,失败则坐标点击)
- 🛡️ 避免被识别为机器人

**完整流程**:
1. 用户粘贴取证信息(包含侵权链接)
2. 解析取证信息,提取侵权链接和备注
3. 打开WebView访问侵权链接
4. 自动拦截URL Scheme打开抖音APP
5. 观看侵权视频5秒
6. 智能返回到首页并点击"我"
7. 清空剪贴板
8. 打开权利卫士
9. 填充备注(格式: 原创名称-抖音:侵权人名称)
10. 开始录屏
11. **🆕 权利卫士点击"开始取证"**
12. **🆕 权利卫士自动跳转到抖音**
13. **🆕 随机延迟1-2秒**
14. **🆕 自动点击"更多"按钮**
15. **🆕 随机延迟1-2秒**
16. **🆕 自动点击"设置"按钮**
17. 录制律师资质
18. 录制侵权视频

**技术亮点**:
- ⏱️ 随机延迟1-2秒,模拟真人操作
- 🎯 阶段标识,区分两次打开抖音
- 📱 监听抖音事件,自动化操作
- 🔍 智能点击(文本查找+坐标备用)
- 🛡️ 避免被识别为机器人

### V2.3 (2026-02-06)

**智能返回到首页并点击"我" - 避免权利卫士环境检测**

- ✅ 观看侵权视频5秒后智能返回到首页
- ✅ 自动检测是否到达首页(查找底部导航栏)
- ✅ 如果未到达首页,自动再按一次返回键
- ✅ 自动点击底部导航栏的"我"按钮
- ✅ 在"我"页面打开权利卫士,避免环境检测

**完整流程**:
1. 用户粘贴取证信息(包含侵权链接)
2. 解析取证信息,提取侵权链接和备注
3. 打开WebView访问侵权链接
4. 自动拦截URL Scheme打开抖音APP
5. 观看侵权视频5秒
6. 🆕 智能返回到首页(最多返回2次)
7. 🆕 点击"我"按钮进入个人页面
8. 清空剪贴板
9. 打开权利卫士
10. 填充备注(格式: 原创名称-抖音:侵权人名称)
11. 开始录屏
12. 录制律师资质
13. 录制侵权视频

**技术亮点**:
- 🔍 智能检测底部导航栏(查找"我"按钮,y坐标>2000)
- 🔙 多次返回机制(确保到达首页)
- 👤 坐标点击"我"按钮(避免UI dump超时)
- 🛡️ 避免权利卫士环境检测

### V2.2 (2026-02-05)

**WebView方案 - 无需外部浏览器,直接打开抖音**

- ✅ 创建WebView Activity(APP内嵌浏览器)
- ✅ 自动拦截抖音URL Scheme (snssdk1128://)
- ✅ 使用Intent直接打开抖音APP
- ✅ 无需依赖外部浏览器
- ✅ 修复Android 13+广播接收器注册问题

### V2.1 (2026-02-04)

**打开侵权链接功能 - 通过夸克浏览器观看侵权视频**

- ✅ 在开始录屏前先打开侵权链接
- ✅ 通过夸克浏览器访问侵权链接
- ✅ 自动跳转到抖音观看侵权视频
- ✅ 观看完成后自动最小化抖音

### V2.0 (2026-02-03)

**清空剪贴板机制 - 避免录屏中出现"打开看看"弹窗**

- ✅ 在开始录屏前自动清空剪贴板
- ✅ 避免打开抖音时弹出"打开看看"页面
- ✅ 确保录屏过程中不会出现口令打开弹窗
- ✅ 符合取证流程要求

### V1.6 (2025-01-20)

**悬浮窗拖动功能修复 + UI Dump分享功能**

- ✅ 修复悬浮窗无法拖动的问题
- ✅ 实现智能拖动检测(移动距离>10像素)
- ✅ 完整状态:整个悬浮窗空白区域可拖动
- ✅ 最小化状态:小圆点可拖动,轻点恢复
- ✅ 点击Dump按钮自动生成.md文件
- ✅ 自动弹出系统分享对话框
- ✅ 可直接分享到微信、QQ等应用
- ✅ 添加存储权限管理

### V1.5 (2025-01-20)

**应用验真界面自动化 + 截屏保存到相册**

- ✅ 自动检测并点击抖音容器
- ✅ 随机延迟1-3秒模拟真实用户
- ✅ 自动截屏保存应用验真页面
- ✅ 截图保存到公共相册(Pictures/权利卫士取证)
- ✅ 使用MediaStore API保存到相册
- ✅ 阻止主循环重复点击

详细更新内容请查看 [Git版本记录](./项目文档整理/Git版本记录.md)

### V1.4 (2025-01-20)

**系统录屏权限弹窗自动化完善**

- ✅ 通过按钮ID识别系统对话框
- ✅ 修复点击时序问题
- ✅ 优化等待时间策略

### V1.3 (2025-01-19)

**系统录屏权限弹窗自动化 + 玻璃质感UI优化**

- ✅ 实现系统录屏权限弹窗自动化处理
- ✅ 智能检测并点击"单个应用"下拉框
- ✅ 自动选择"整个屏幕"选项
- ✅ 自动点击"立即开始"按钮
- ✅ 完成从启动到开始录屏的完整自动化
- ✅ 优化UI界面,实现玻璃质感设计

### V1.2 (2025-01-19)

**备注输入与自动填充功能**

- ✅ 添加备注输入框
- ✅ 实现备注自动填充
- ✅ 实现自动点击"开始录屏取证"
- ✅ 修复无障碍服务配置问题

### V1.1 (2026-01-19)

**Android UI界面开发**

- ✅ 完成Android UI界面开发
- ✅ 实现Material Design设计规范
- ✅ 创建主界面、设置界面、日志界面
- ✅ 设计悬浮窗控制面板
- ✅ 统一淡蓝色配色方案

### V1.0 (2026-01-19)

**项目初始化**

- ✅ 完成项目文档系统建立
- ✅ 完成权利卫士应用分析
- ✅ 完成技术方案设计
- ✅ 创建核心文档体系

---

## 📄 许可证

本项目仅供学习和研究使用,请勿用于非法用途。

---

## 👨‍💻 开发团队

- 开发者: 小牛马
- 项目负责人: 刀仔老板

---

**最后更新**: 2026-02-04 (V2.1)

